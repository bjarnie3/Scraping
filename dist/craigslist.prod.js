"use strict";var puppeteer=require("puppeteer"),cheerio=require("cheerio"),mongoose=require("mongoose"),Listing=require("./model/Listing"),scrapingResults=[{title:"Entry Level Software Engineer - C or C++",datePosted:new Date("2019-07-26 12:00:00"),neighborhood:"(palo alto)",url:"https://sfbay.craigslist.org/pen/sof/d/palo-alto-entry-level-software-engineer/6943135190.html",jobDescription:"Major Technology company is seeking an Entry Level software Engineer. The ideal candidate will have extensive school project experience with C or C++. Under general supervision...",compensation:"Up to US$0.00 per year"}];function connectToMongoDb(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(mongoose.connect("mongodb://craigslistuser:SuperStrongPassword1@ds047948.mlab.com:47948/heroku_ckm9v41c",{useNewUrlParser:!0}));case 2:console.log("connected to mongodb");case 3:case"end":return e.stop()}})}function scrapeListings(r){var t,i,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(r.goto("https://sfbay.craigslist.org/d/software-qa-dba-etc/search/sof"));case 2:return e.next=4,regeneratorRuntime.awrap(r.content());case 4:return t=e.sent,i=cheerio.load(t),n=i(".result-info").map(function(e,r){var t=i(r).find(".result-title"),n=i(r).find(".result-date"),o=i(r).find(".result-hood"),a=i(t).text(),s=i(o).text().trim().replace("(","").replace(")","");return{title:a,url:i(t).attr("href"),datePosted:new Date(i(n).attr("datetime")),neighborhood:s}}).get(),e.abrupt("return",n);case 8:case"end":return e.stop()}})}function scrapeJobDescriptions(r,t){var n,o,a,s,i,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(n<r.length)return e.next=4,regeneratorRuntime.awrap(t.goto(r[n].url));e.next=22;break;case 4:return e.next=6,regeneratorRuntime.awrap(t.content());case 6:return o=e.sent,a=cheerio.load(o),s=a("#postingbody").text(),i=a("p.attrgroup > span:nth-child(1) > b").text(),r[n].jobDescription=s,r[n].compensation=i,console.log(r[n].jobDescription),console.log(r[n].compensation),c=new Listing(r[n]),e.next=17,regeneratorRuntime.awrap(c.save());case 17:return e.next=19,regeneratorRuntime.awrap(sleep(1e3));case 19:n++,e.next=1;break;case 22:case"end":return e.stop()}})}function sleep(r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){return setTimeout(e,r)}));case 1:case"end":return e.stop()}})}function main(){var r,t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(connectToMongoDb());case 2:return e.next=4,regeneratorRuntime.awrap(puppeteer.launch({headless:!1}));case 4:return r=e.sent,e.next=7,regeneratorRuntime.awrap(r.newPage());case 7:return t=e.sent,e.next=10,regeneratorRuntime.awrap(scrapeListings(t));case 10:return n=e.sent,e.next=13,regeneratorRuntime.awrap(scrapeJobDescriptions(n,t));case 13:e.sent,console.log(n);case 15:case"end":return e.stop()}})}main();