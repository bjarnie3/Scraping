"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(i)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}require("isomorphic-fetch");var cheerio=require("cheerio"),redis=require("redis"),util=require("util"),cacheTtl=1e6,redisOptions={url:"redis://127.0.0.1:6379/0"},client=redis.createClient(redisOptions),asyncGet=util.promisify(client.get).bind(client),asyncSet=util.promisify(client.set).bind(client);function get(t,r){var n,i,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(asyncGet(r));case 2:if(n=e.sent)return e.abrupt("return",n);e.next=5;break;case 5:return e.next=7,regeneratorRuntime.awrap(fetch(t));case 7:return i=e.sent,e.next=10,regeneratorRuntime.awrap(i.text());case 10:return a=e.sent,e.next=13,regeneratorRuntime.awrap(asyncSet(r,a,"EX",cacheTtl));case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}})}function getJobDescription(t){var r,n,i,a,o,c,s,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.href.replace("https://www.tvinna.is/jobs/","").replace("/",""),n="tvinna:".concat(r),i=t.href,console.log("fetch",i,n),e.next=6,regeneratorRuntime.awrap(get(i,n));case 6:return a=e.sent,o=cheerio.load(a),c=o(".job-detail p, .job-detail ul"),s=[],c.each(function(e,t){s.push(o(t).text())}),u=s.join(" "),t.description=u,e.abrupt("return",t);case 14:case"end":return e.stop()}})}function scrape(){var t,f,r,h,n,i,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(get("http://tvinna.is","tvinna:forsida"));case 2:t=e.sent,f=cheerio.load(t),r=f(".job-listing li a"),h=[],r.each(function(e,t){var r=f(t).find("h2").text(),n=f(t).find("p").text(),i=f(t).attr("href"),a=_slicedToArray(n.split(" | "),2),o=a[0],c=void 0===o?"":o,s=a[1],u=void 0===s?"":s,l=f(t).find(".view-track").text().replace("Skoðað ","").replace(" sinnum",""),p=f(t).find("time").text();h.push({title:r,href:i,employer:c,type:u,views:Number(l),date:p})}),n=[],i=0;case 9:if(i<h.length)return e.next=12,regeneratorRuntime.awrap(getJobDescription(h[i]));e.next=18;break;case 12:a=e.sent,n.push(a),console.log("Processed Job!");case 15:i++,e.next=9;break;case 18:console.log(n),client.quit();case 20:case"end":return e.stop()}})}scrape().catch(function(e){return console.error(e)});